<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üì¶ Inventario - Farmacia Lili √ìptica</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
* {box-sizing:border-box;}
body { font-family: system-ui, sans-serif; background:#1e2f52; color:#e5e7eb; margin:0; padding:0;}
header {background:#111827; padding:16px; font-size:20px; font-weight:bold; text-align:center;}
main {padding:16px; display:flex; flex-direction:column; gap:16px;}
.main-menu { display:flex; gap:12px; background:#111827; padding:10px 16px; position:sticky; top:0; z-index:1000; border-bottom:1px solid #1f2937;}
.main-menu .menu-link {color:#e5e7eb; text-decoration:none; padding:8px 12px; border-radius:8px; font-weight:500; transition:0.2s;}
.main-menu .menu-link:hover {background:#1f2937;}
.main-menu .menu-link.active {background:#2563eb; color:white;}
#logout {background:#dc2626; margin-left:auto; padding:8px 12px; border-radius:8px; color:white; border:none; cursor:pointer; transition:0.2s;}
#logout:hover {background:#b91c1c;}
#admin {background:#26a9dc; padding:8px 12px; border-radius:8px; color:white; border:none; cursor:pointer; transition:0.2s;}
#admin:hover {background:#2563eb;}
#cajero {font-size:14px; margin-left:16px; color:#facc15;}
input, button, select {padding:9px; border-radius:6px; border:none; margin:4px 0;}
input, select {width:200px;}
button {background:#2563eb; color:white; cursor:pointer; font-weight:bold;}
button:hover {background:#1d4ed8;}
.btn{padding:0.4rem 1rem; border:none; border-radius:8px; cursor:pointer; font-weight:500; transition:0.2s;}
.btn-edit{background:#2563eb; color:#fff;} .btn-edit:hover{background:#1e40af;}
.btn-del{background:#dc2626; color:#fff;} .btn-del:hover{background:#991b1b;}
.btn-pdf{background:#facc15; color:#000; margin-left:5px;} .btn-pdf:hover{background:#eab308;}
.oculto{display:none;}
.panel-admin{background:#111827; border:2px solid #2563eb; padding:1rem; border-radius:12px; margin-bottom:1rem;}
.stock-verde{background:#16a34a; color:#fff;}
.stock-amarillo{background:#eab308; color:#000;}
.stock-rojo{background:#b91c1c; color:#fff;}
.cad-verde{background:#16a34a; color:#fff;}
.cad-amarillo{background:#eab308; color:#000;}
.cad-rojo{background:#b91c1c; color:#fff;}
.categoria-antibiotico{background:#16a34a; color:#fff;}
.categoria-papeleria{background:#7c3e12; color:#fff;}
.categoria-tienda{background:#9d4edd; color:#fff;}
.categoria-farmacia{background:#facc15; color:#000;}
.categoria-proveedores{background:#f97316; color:#fff;}
@keyframes fadein { from{opacity:0;transform:translateY(30px);} to{opacity:1;transform:translateY(0);} }
section { text-align: center; width: 95%; background: linear-gradient(120deg,#111827 80%,#2563eb11 100%); padding: 24px; border-radius: 15px; box-shadow: 0 8px 28px rgba(0,0,0,.35); margin: 12px auto; transition: transform 0.2s, box-shadow 0.2s; }
section:hover { transform: translateY(-4px); box-shadow: 0 12px 36px rgba(0,0,0,.45); }
h2.seccion { display:flex; justify-content:space-between; align-items:center; margin-top:0; color:#60a5fa; }
table {width:100%; border-collapse:collapse; margin-top:12px;}
th, td {padding:8px; border:1px solid #374151; text-align:left;}
th {background:#1f2937;}
</style>
</head>
<body>
<header>üì¶ Inventario - Farmacia Lili √ìptica</header>
<nav class="main-menu">
  <a href="ven.html" class="menu-link">üí≥ Ventas</a>
  <a href="inven.html" class="menu-link active">üì¶ Inventario</a>
  <a href="hitori.html" class="menu-link">üìú Historial</a>
  <span id="cajero"></span>
  <button id="admin">Administrador</button>
  <button id="logout">Cerrar Sesi√≥n</button>
</nav>

<section id="loginSection" class="oculto">
  <h2>üëë PANEL ADMINISTRACI√ìN</h2>
  üîê Ingresa Contrase√±a
  <form id="loginForm">
    <input type="password" id="adminPass" placeholder="Contrase√±a" required>
    <button type="submit" class="btn btn-edit">Ingresar</button>
  </form>
</section>

<section id="adminSection" class="oculto panel-admin">
  <h2>‚öôÔ∏è Panel Administrador</h2>
  <form id="addForm" style="margin-top:1rem;">
    <h3>‚ûï Agregar Producto</h3>
    <input type="text" id="nombre" placeholder="Nombre" required>
    <input type="text" id="codigo" placeholder="C√≥digo" required>
    <input type="number" id="precio" placeholder="Precio">
    <input type="text" id="lote" placeholder="Lote (solo antibi√≥ticos)">
    <input type="number" id="stock" placeholder="Stock">
    <input type="number" id="stockMin" placeholder="Stock M√≠nimo">
    <input type="number" id="entradas" placeholder="Entradas">
    <select id="categoria" required>
      <option value="Antibi√≥tico">Antibi√≥tico</option>
      <option value="Papeler√≠a">Papeler√≠a</option>
      <option value="Tienda">Tienda</option>
      <option value="Farmacia">Farmacia</option>
      <option value="Proveedores">Proveedores</option>
    </select>
    <input type="date" id="caducidad" placeholder="Caducidad (solo antibi√≥ticos)">
    <div style="margin-top:10px;">
      <button type="submit" class="btn btn-edit">Guardar</button>
      <button type="button" id="salirAdmin" class="btn btn-del">Salir</button>
    </div>
  </form>
</section>

<section id="generalSection">
  <h2 class="seccion">üì¶ Inventario - General
    <button class="btn btn-pdf oculto" onclick="imprimirPDF('tablaGeneralCompleta','Inventario General')">üñ®Ô∏è Descargar PDF</button>
  </h2>
  <table id="tablaGeneralCompleta">
    <thead>
      <tr>
        <th>Nombre</th><th>C√≥digo</th><th>Precio</th><th>Lote</th>
        <th>Stock</th><th>Stock M√≠nimo</th><th>Entradas</th>
        <th>Categor√≠a</th><th>Caducidad</th><th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="AntibioticosSection">
  <h2 class="seccion">üíä Antibi√≥ticos
    <button class="btn btn-pdf oculto" onclick="imprimirPDF('tablaAntibioticos','Inventario Antibi√≥ticos')">üñ®Ô∏è Descargar PDF</button>
  </h2>
  <table id="tablaAntibioticos">
    <thead>
      <tr>
        <th>Nombre</th><th>C√≥digo</th><th>Precio</th><th>Lote</th>
        <th>Stock</th><th>Stock M√≠nimo</th><th>Entradas</th>
        <th>Categor√≠a</th><th>Caducidad</th><th>Acciones</th>
      </tr>
    </thead>
    <tbody><tr><td colspan="10">Sin productos</td></tr></tbody>
  </table>
</section>

<section id="ProveedoresSection">
  <h2 class="seccion">üì¶ Proveedores
    <button class="btn btn-pdf oculto" onclick="imprimirPDF('tablaProveedores','Inventario Proveedores')">üñ®Ô∏è Descargar PDF</button>
  </h2>
  <table id="tablaProveedores">
    <thead>
      <tr>
        <th>Nombre</th><th>C√≥digo</th><th>Categor√≠a</th><th>Acciones</th>
      </tr>
    </thead>
    <tbody><tr><td colspan="4">Sin productos</td></tr></tbody>
  </table>
</section>

<script>
// ---------------------- Usuario Activo ----------------------
let usuarioActivo = localStorage.getItem("usuarioActivo") || "Cajero";
document.getElementById("cajero").textContent = "üë§ Cajero: " + usuarioActivo;

// ---------------------- Logout ----------------------
document.getElementById("logout").onclick = () => {
    localStorage.removeItem("usuarioActivo");
    alert("Sesi√≥n cerrada.");
    window.location.reload();
};

// ---------------------- Variables ----------------------
let userType='cajero';
const adminBtn=document.getElementById('admin');
const loginSection=document.getElementById('loginSection');
const adminSection=document.getElementById('adminSection');
const loginForm=document.getElementById('loginForm');
const addForm=document.getElementById('addForm');
const categoriaSelect=document.getElementById('categoria');
const salirAdmin=document.getElementById('salirAdmin');
const tablaGeneral=document.getElementById('tablaGeneralCompleta').querySelector('tbody');
const tablas={
  'Antibi√≥tico':document.getElementById('tablaAntibioticos').querySelector('tbody'),
  'Papeler√≠a':tablaGeneral,
  'Tienda':tablaGeneral,
  'Farmacia':tablaGeneral,
  'Proveedores':document.getElementById('tablaProveedores').querySelector('tbody')
};
let productosInventario = JSON.parse(localStorage.getItem('inventario')) || [];
let productoEnEdicion = null;

// ---------------------- Login Admin ----------------------
adminBtn.addEventListener('click',()=>loginSection.classList.toggle('oculto'));
loginForm.addEventListener('submit', e=>{
  e.preventDefault();
  const passInput=document.getElementById('adminPass');
  if(passInput.value==='1234'){
    userType='admin';
    loginSection.classList.add('oculto');
    adminSection.classList.remove('oculto');
    alert('Acceso como Administrador');
  } else {
    userType='cajero';
    loginSection.classList.add('oculto');
    alert('Acceso como Cajero');
  }
  passInput.value='';
  renderInventario();
  renderTablasInventario();
});

// ---------------------- Salir Admin ----------------------
salirAdmin.addEventListener('click', ()=>{
  userType='cajero';
  adminSection.classList.add('oculto');
  renderInventario();
  renderTablasInventario();
});

// ---------------------- Campos din√°micos ----------------------
categoriaSelect.addEventListener('change', ()=>{
  const lote=document.getElementById('lote'), cad=document.getElementById('caducidad'),
        precio=document.getElementById('precio'), stock=document.getElementById('stock'),
        stockMin=document.getElementById('stockMin'), entradas=document.getElementById('entradas');
  if(categoriaSelect.value==='Antibi√≥tico'){
    lote.style.display='inline-block'; cad.style.display='inline-block';
    precio.style.display='inline-block'; stock.style.display='inline-block';
    stockMin.style.display='inline-block'; entradas.style.display='inline-block';
  } else if(categoriaSelect.value==='Proveedores'){
    lote.style.display='none'; cad.style.display='none';
    precio.style.display='none'; stock.style.display='none';
    stockMin.style.display='none'; entradas.style.display='none';
  } else{
    lote.style.display='none'; cad.style.display='none';
    precio.style.display='inline-block'; stock.style.display='inline-block';
    stockMin.style.display='inline-block'; entradas.style.display='inline-block';
  }
});

// ---------------------- Guardar y eliminar productos ----------------------
function guardarProductoLocal(producto){
  if(productoEnEdicion){
    const index = productosInventario.findIndex(p=>p.codigo===productoEnEdicion.codigo);
    productosInventario[index] = producto;
    productoEnEdicion = null;
  }else{
    productosInventario.push(producto);
  }
  localStorage.setItem('inventario', JSON.stringify(productosInventario));
  renderTablasInventario();
}

function eliminarProductoLocal(codigo){
  productosInventario = productosInventario.filter(p=>p.codigo!==codigo);
  localStorage.setItem('inventario', JSON.stringify(productosInventario));
  renderTablasInventario();
}

// ---------------------- Render Tablas ----------------------
function renderTablasInventario(){
  tablaGeneral.innerHTML = '';
  tablas['Antibi√≥tico'].innerHTML = '';
  tablas['Proveedores'].innerHTML = '';

  const productosNoProveedores = productosInventario.filter(p => p.categoria !== 'Proveedores');
  const productosProveedores = productosInventario.filter(p => p.categoria === 'Proveedores');

  productosNoProveedores.forEach(p=>{
    const row = document.createElement('tr');
    row.innerHTML=`
      <td>${p.nombre}</td>
      <td>${p.codigo}</td>
      <td>${p.precio}</td>
      <td>${p.lote||''}</td>
      <td>${p.stock||''}</td>
      <td>${p.stockMin||''}</td>
      <td>${p.entradas||''}</td>
      <td>${p.categoria}</td>
      <td>${p.caducidad||''}</td>
      <td>
        ${userType==='admin' ? `<button class="btn btn-edit" onclick='editarProducto(${JSON.stringify(p)})'>‚úèÔ∏è</button>
        <button class="btn btn-del" onclick='eliminarProductoLocal("${p.codigo}")'>üóëÔ∏è</button>` : ''}
      </td>
    `;
    if(p.categoria==='Antibi√≥tico') tablas['Antibi√≥tico'].appendChild(row);
    else tablaGeneral.appendChild(row);
  });

  productosProveedores.forEach(p=>{
    const row=document.createElement('tr');
    row.innerHTML=`
      <td>${p.nombre}</td>
      <td>${p.codigo}</td>
      <td>${p.categoria}</td>
      <td>
        ${userType==='admin' ? `<button class="btn btn-edit" onclick='editarProducto(${JSON.stringify(p)})'>‚úèÔ∏è</button>
        <button class="btn btn-del" onclick='eliminarProductoLocal("${p.codigo}")'>üóëÔ∏è</button>` : ''}
      </td>
    `;
    tablas['Proveedores'].appendChild(row);
  });

  renderInventario();
}

// ---------------------- Formulario ----------------------
addForm.addEventListener('submit', e=>{
  e.preventDefault();
  const p = {
    nombre: document.getElementById('nombre').value,
    codigo: document.getElementById('codigo').value,
    precio: parseFloat(document.getElementById('precio').value) || 0,
    lote: document.getElementById('lote').value || null,
    stock: parseInt(document.getElementById('stock').value) || 0,
    stockMin: parseInt(document.getElementById('stockMin').value) || 0,
    entradas: parseInt(document.getElementById('entradas').value) || 0,
    categoria: document.getElementById('categoria').value,
    caducidad: document.getElementById('caducidad').value || null,
  };
  guardarProductoLocal(p);
  addForm.reset();
});

function editarProducto(p){
  productoEnEdicion=p;
  document.getElementById('nombre').value=p.nombre;
  document.getElementById('codigo').value=p.codigo;
  document.getElementById('precio').value=p.precio;
  document.getElementById('lote').value=p.lote;
  document.getElementById('stock').value=p.stock;
  document.getElementById('stockMin').value=p.stockMin;
  document.getElementById('entradas').value=p.entradas;
  document.getElementById('categoria').value=p.categoria;
  document.getElementById('caducidad').value=p.caducidad;
  categoriaSelect.dispatchEvent(new Event('change'));
}

// ---------------------- PDF ----------------------
function imprimirPDF(tablaId,titulo){
  if(userType!=='admin') return;
  const { jsPDF } = window.jspdf;
  const doc=new jsPDF({orientation:'landscape'});
  const tabla=document.getElementById(tablaId);
  const fecha=new Date();
  doc.setFontSize(16); doc.text(titulo,10,10);
  doc.setFontSize(10); doc.text(`Fecha: ${fecha.toLocaleDateString()} Hora: ${fecha.toLocaleTimeString()}`,10,16);
  const encabezado=[], datos=[];
  tabla.querySelectorAll('thead th').forEach(th=>encabezado.push(th.innerText));
  tabla.querySelectorAll('tbody tr').forEach(tr=>{
    const celdas=tr.querySelectorAll('td');
    if(celdas.length>1 && !celdas[0].hasAttribute('colspan')) datos.push([...celdas].map(td=>td.innerText));
  });
  doc.autoTable({head:[encabezado],body:datos,startY:28,theme:'grid',headStyles:{fillColor:[24,119,242],textColor:[255,255,255]},styles:{fontSize:10}});
  doc.save(`${titulo}.pdf`);
}

// ---------------------- Render seg√∫n usuario ----------------------
function renderInventario(){
  if(userType==='cajero'){
    adminSection.classList.add('oculto');
    document.querySelectorAll('.btn-pdf').forEach(b=>b.classList.add('oculto'));
  }else{
    adminSection.classList.remove('oculto');
    document.querySelectorAll('.btn-pdf').forEach(b=>b.classList.remove('oculto'));
  }
}

// Inicializar
document.addEventListener('DOMContentLoaded', ()=>{
  renderTablasInventario();
});
</script>
</body>
</html>
